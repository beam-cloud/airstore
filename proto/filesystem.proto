syntax = "proto3";

option go_package = "github.com/beam-cloud/airstore/proto";

package filesystem;

// FilesystemService provides filesystem metadata operations.
// This service caches filesystem metadata for fast FUSE operations.
service FilesystemService {
  // Stat returns metadata for a path (file or directory).
  rpc Stat(StatRequest) returns (StatResponse);
  
  // ReadDir returns directory entries.
  rpc ReadDir(ReadDirRequest) returns (ReadDirResponse);
  
  // Mkdir creates a directory.
  rpc Mkdir(MkdirRequest) returns (MkdirResponse);
  
  // Create creates a file.
  rpc Create(CreateRequest) returns (CreateResponse);
  
  // Rename renames a file or directory.
  rpc Rename(RenameRequest) returns (RenameResponse);
  
  // Remove removes a file or directory.
  rpc Remove(RemoveRequest) returns (RemoveResponse);
  
  // Chmod changes file permissions.
  rpc Chmod(ChmodRequest) returns (ChmodResponse);
}

// FileStat contains metadata about a file or directory.
message FileStat {
  string path = 1;
  string name = 2;
  int64 size = 3;
  uint32 mode = 4;
  int64 mtime = 5;     // Unix timestamp
  bool is_dir = 6;
  bool is_symlink = 7;
  string symlink_target = 8;
}

// DirEntry represents an entry in a directory listing.
message DirEntry {
  string name = 1;
  uint32 mode = 2;
  int64 size = 3;
  int64 mtime = 4;
  bool is_dir = 5;
}

// Stat
message StatRequest {
  string path = 1;
}

message StatResponse {
  bool ok = 1;
  string error = 2;
  FileStat info = 3;
}

// ReadDir
message ReadDirRequest {
  string path = 1;
}

message ReadDirResponse {
  bool ok = 1;
  string error = 2;
  repeated DirEntry entries = 3;
}

// Mkdir
message MkdirRequest {
  string path = 1;
  uint32 mode = 2;
}

message MkdirResponse {
  bool ok = 1;
  string error = 2;
}

// Create
message CreateRequest {
  string path = 1;
  uint32 mode = 2;
}

message CreateResponse {
  bool ok = 1;
  string error = 2;
}

// Rename
message RenameRequest {
  string old_path = 1;
  string new_path = 2;
}

message RenameResponse {
  bool ok = 1;
  string error = 2;
}

// Remove
message RemoveRequest {
  string path = 1;
}

message RemoveResponse {
  bool ok = 1;
  string error = 2;
}

// Chmod
message ChmodRequest {
  string path = 1;
  uint32 mode = 2;
}

message ChmodResponse {
  bool ok = 1;
  string error = 2;
}
