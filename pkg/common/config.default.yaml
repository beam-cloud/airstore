# Airstore Gateway Configuration
# Mode: "local" (no Redis/Postgres) or "remote" (full infrastructure)
mode: remote

clusterName: airstore
debugMode: false
prettyLogs: true

# Database (remote mode only)
database:
  redis:
    mode: single
    addrs: [redis-master:6379]
    enableTLS: false
    dialTimeout: 3s
  postgres:
    host: postgres
    port: 5432
    user: airstore
    password: airstore
    database: airstore
    sslMode: disable
    maxOpenConns: 25
    maxIdleConns: 5

# Storage
image:
  s3:
    bucket: airstore-images
    region: us-east-1
    endpoint: http://localstack:4566
    accessKey: test
    secretKey: test
    forcePathStyle: true
  cachePath: /var/lib/clip/cache
  workPath: /var/lib/clip/work
  mountPath: /var/lib/clip/mnt

# Sandbox configuration for task execution
sandbox:
  defaultImage: public.ecr.aws/n4e0e1y0/airstore-default-sandbox:latest

filesystem:
  mountPoint: /tmp/airstore
  # Per-workspace S3 storage (bucket created per workspace: {prefix}-{external_id})
  workspaceStorage:
    defaultBucketPrefix: workspace
    defaultAccessKey: test
    defaultSecretKey: test
    defaultEndpointUrl: http://localstack:4566
    defaultRegion: us-east-1

# Gateway
gateway:
  # Admin token for workspace API authentication (used by airstore-ui)
  authToken: ""
  grpc:
    port: 1993
    maxRecvMsgSize: 16
    maxSendMsgSize: 16
  http:
    host: 0.0.0.0
    port: 1994
    enablePrettyLogs: true
    cors:
      allowOrigins: ["*"]
      allowHeaders: ["*"]
      allowMethods: ["*"]
  shutdownTimeout: 30s

# Scheduler (remote mode only)
scheduler:
  enabled: false
  gatewayServiceName: airstore-gateway
  workerImage: public.ecr.aws/n4e0e1y0/airstore-worker:latest
  workerNamespace: airstore
  workerTTL: 1h
  workerShutdownTimeout: 5m  # Time to wait for running tasks during graceful shutdown
  cleanupInterval: 1m
  heartbeatInterval: 10s
  heartbeatTimeout: 30s
  defaultWorkerCpu: 1000
  defaultWorkerMemory: 1024
  pools:
    default:
      deploymentName: airstore-worker-default
      namespace: airstore
      minReplicas: 1
      maxReplicas: 10
      scaleDownDelay: 5m
      workerCpu: 1000
      workerMemory: 1024

# Tools - All built-in tool configuration
tools:
  # Builtin integrations (API keys)
  integrations:
    weather:
      apiKey: ""   # OpenWeatherMap
    exa:
      apiKey: ""   # Exa neural search
    github:
      enabled: false

  # MCP servers - tools auto-exposed as /tools/<name>
  # Example:
  #   mcp:
  #     filesystem:
  #       command: npx
  #       args: ["-y", "@modelcontextprotocol/server-filesystem", "/tmp"]
  mcp: {}

# Anthropic (for BAML inference and Claude Code tasks)
anthropic:
  apiKey: ""
